<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Overview </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Overview ">
      
      <link rel="icon" href="../../favicon.png">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/veracity-engineering/SolutionPackageDoc/blob/master/docs/articles/userManagement/overview.md/#L1">
  </head>

  <script type="module">
    import options from './../../public/main.js'
    import { init } from './../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="overview">Overview</h1>

<p>In this section, you learn the different modes of user management, permission setup, package limitations, and decide the adoption of the package.</p>
<h2 id="1-three-user-management-modes">1. Three user management modes</h2>
<blockquote>
<p>one user is allowed to be assigned to mutiple companies. <code>Company_CompanyRole_User</code> is the default mode.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Company</th>
<th>Role</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Company_CompanyRole_User</code></td>
<td>✓</td>
<td>✓ Role is defined at company level.</td>
<td>✓</td>
</tr>
<tr>
<td><code>Company_GlobalRole_User</code></td>
<td>✓</td>
<td>✓ Role is defined at global level.</td>
<td>✓</td>
</tr>
<tr>
<td><code>Role_User</code></td>
<td>☒</td>
<td>✓</td>
<td>✓</td>
</tr>
</tbody>
</table>
<h3 id="change-default-user-management-mode">Change default user management mode</h3>
<blockquote>
<p>API endpoint and schema has slight difference on different modes.</p>
</blockquote>
<pre><code class="lang-cs">    public class Startup
    {
        //...
        public void ConfigureServices(IServiceCollection services)
        {
            //...
            services.AddUserManagement(
                new UserManagementOptions
                {
                    //...
                    Mode = UserManagementMode.Role_User
                });
            //...
        }
    }
</code></pre>
<h2 id="2-permission-setup">2. Permission setup</h2>
<h3 id="build-in-permissions">Build-in Permissions</h3>
<p>The following are serveral built-in permissions used to authorize user management apis.
| Permission | Description |
|--|--|
| <code>Premissions.ManageUser</code> | permission to make change on user. |
| <code>Premissions.ViewUser</code> | permission to read user. |
| <code>Premissions.ManageRole</code> | permission to make change on role. |
| <code>Premissions.ViewRole</code> | permission to read role. |
| <code>Premissions.ManageCompany</code> | permission to make change on company. |
| <code>Premissions.ViewCompany</code> | permission to read company. |</p>
<h3 id="create-your-own-premissions">Create your own premissions</h3>
<p>Define permissions by implementing interface - <code>IPermissionMatrix</code>. The following code defined two permissions.</p>
<blockquote>
<p>You are also allowed to manage permissions outside of the source code. <a href="permissionStore">Here is the instruction</a>.</p>
</blockquote>
<pre><code class="lang-cs">    public class PermissionBook : IPermissionMatrix
    {
        public enum WeatherPermission
        {
            //...

            [PermissionValue(id: &quot;8&quot;, key: &quot;ReadWeather&quot;, name: &quot;Read Weather&quot;, group: &quot;Weather&quot;, description: &quot;ReadWeather&quot;)]
            ReadWeather,

            [PermissionValue(id: &quot;9&quot;, key: &quot;WriteWeather&quot;, name: &quot;Write Weather&quot;, group: &quot;Weather&quot;, description: &quot;WriteWeather&quot;)]
            WriteWeather,

            //... other permissions
        }
    }
</code></pre>
<h3 id="authorize-api-with-permissions">Authorize API with permissions</h3>
<p>Decorates API actions with permission.</p>
<blockquote>
<p>You are also allowed to use Role-based authorization like <code>[Authorize(Roles = &quot;****&quot;)]</code>. <a href="authorize">Here is the instruction</a>.</p>
</blockquote>
<pre><code class="lang-cs">        [HttpGet]
        [PermissionAuthorize(WeatherPermission.ReadWeather)]
        public IEnumerable&lt;WeatherForecast&gt; Get()
        {
            //... api logic
        }
</code></pre>
<h2 id="3-data-model">3. Data Model</h2>
<p>The predefeind data models of <code>Company</code>, <code>Role</code> and <code>User</code> may not fully meet your needs. Please check the <a href="dataModel">built-in model definition</a>, and follow this <a href="customModel">instruction</a> to extend the data model.</p>
<h2 id="4-company-role-user-deletion">4. Company/ Role/ User deletion</h2>
<p>By default, the soft deletion is enabled. Change the default behavior to hard delete record.</p>
<pre><code class="lang-cs">    public class Startup
    {
        //...
        public void ConfigureServices(IServiceCollection services)
        {
            //...
            services.AddUserManagement().UseEFCore(new EFCoreOptions
                {
                    DbContextOptionsBuilder = options =&gt; options.UseSqlServer(@&quot;Data Source=.\SQLEXPRESS;Initial Catalog=UserManagement;Trusted_Connection=Yes;&quot;),
                    HardDelete = true
                });
            //...
        }
    }
</code></pre>
<h2 id="5-data-access-implementation">5. Data Access Implementation</h2>
<p>We provide data access implementation in package - <code>DNVGL.Authorization.UserManagement.EFCore</code>. It has dependency on EF Core 5.0+.</p>
<p>If you don't want to introduce EF Core in your project. then this package is not required to be installed. Here is an instruction to <a href="dataAccess">Replace EF Core with your own data access</a></p>
<h2 id="6-performance-">6. Performance ✓</h2>
<p>By default, The package reads and check user's permission from database for every http request. You can change this behavior to load user's permission in to claim (in cookie), and then read, check user's premission from claim. The following is to setup such behavior.</p>
<pre><code class="lang-cs">    public class Startup
    {
        //...
        public void ConfigureServices(IServiceCollection services)
        {
            //...
            services.AddAuthentication().AddCookie(o =&gt; o.Events.AddCookieValidateHandler(services));
            //...
        }
    }
</code></pre>
<h2 id="7-swagger-ui">7. Swagger UI</h2>
<p>By default, Swagger UI probably do not show <em>User Management APIs</em>. Then you could follow the <a href="swagger">instructuon</a> to get it displayed.</p>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/veracity-engineering/SolutionPackageDoc/blob/master/docs/articles/userManagement/overview.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          godspeed
        </div>
      </div>
    </footer>
  </body>
</html>